# 配置化实现

## 合并配置的设计与实现

### 需求分析

在发送请求的时候可以传入一个配置来决定请求的不同行为。所以给`axios`来个默认配置，定义一些默认的行为。这样发送每个请求，用户传递的配置可以和默认配置做一层的合并。

和官网 `axios` 库保持一致，我们给 `axios` 对象添加一个 `defaults` 属性，表示默认配置，你甚至可以直接修改这些默认配置：

```typescript
axios.defaults.headers.common['test'] = 123
axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded'
axios.defaults.timeout = 2000
```

其中对于 `headers` 的默认配置支持 `common` 和一些请求 `method` 字段。

`common` 表示对于任何类型的请求都要添加该属性

`method` 表示只有该类型请求方法才会添加对应的属性。

在上述例子中，我们会默认为所有请求的 `header` 添加 `test` 属性，会默认为 `post` 请求的 `header` 添加 `Content-Type` 属性。



### 默认配置定义

在src下创建defaults.ts文件，来填写默认的配置。

`src/defaults`:

```typescript
import {AxiosRequestConfig} from './types'

const defaults:AxiosReqestConfig = {
    method:'get',
    timeout:0,
    headers:{
        common:{
            Accept:'application/json,text/plain,*/*',
        }
    }
}

const methodsNoData = ['delete','get','head','options'];
// 初始化
methodsNoData.forEach(method=>{
    defaults.headers[method]={};
})

const methodsWithData = ['post','put','patch'];
// 初始化
methodsWithData.forEach(method=>{
    defaults.headers[method]={
        'Content-Type': 'application/x-www-form-urlencoded'
    };
});
export default defaults;
```

这里定义了`defaults`常量，它包含了默认请求的方法、超时时间以及`headers`一些配置。

未来我们会根据新的需求添加更多的默认配置。



### 添加到axios对象中